<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=stylesheet href=/main.6201f5d795e66fbf05304d1348e60656f52a2bf20b7376034a0071179ec8a5881eb69432e4b8ae7f7c05a22afa7f9e33f628dca5b1d53f1dadacd7b3e6a86691.css integrity="sha512-YgH115Xmb78FME0TSOYGVvUqK/ILc3YDSgBxF57IpYgetpQy5Liuf3wFoir6f54z9ijcpbHVPx2trNez5qhmkQ==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Laboratorio 4: Seguridad de Redes - Introducción a la Seguridad Computacional</title><meta name=description content="DCC universidad de Chile"><link rel=canonical href=/laboratorios/laboratorio-4/><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/logo_redondo.png"><meta name=twitter:title content="Laboratorio 4: Seguridad de Redes"><meta name=twitter:description content="Instrucciones La siguiente actividad está pensada para su desarrollo en un bloque de auxiliar y un poco más (~3 horas), en grupos de dos personas como máximo. Sin embargo, se les la posibilidad de entregarla hasta el próximo martes 21 de julio, a las 23:59 hrs, sin descuento por ello (El plazo es un poco mayor a 7 días debido al feriado e interferiado).
Al igual que en el laboratorio anterior, antes de partir, recuerden leer la sección de reglas de laboratorios."><meta name=twitter:site content="@dccuchile"><meta name=twitter:creator content="@dccuchile"><meta property="og:title" content="Laboratorio 4: Seguridad de Redes"><meta property="og:description" content="Instrucciones La siguiente actividad está pensada para su desarrollo en un bloque de auxiliar y un poco más (~3 horas), en grupos de dos personas como máximo. Sin embargo, se les la posibilidad de entregarla hasta el próximo martes 21 de julio, a las 23:59 hrs, sin descuento por ello (El plazo es un poco mayor a 7 días debido al feriado e interferiado).
Al igual que en el laboratorio anterior, antes de partir, recuerden leer la sección de reglas de laboratorios."><meta property="og:type" content="article"><meta property="og:url" content="/laboratorios/laboratorio-4/"><meta property="og:image" content="/logo_redondo.png"><meta property="article:published_time" content="2020-07-03T09:00:00-03:00"><meta property="article:modified_time" content="2022-02-07T23:44:42-03:00"><meta property="og:site_name" content="Introducción a la Seguridad Computacional"><meta property="article:publisher" content="https://www.facebook.com/DCCUChile"><meta property="article:author" content="https://www.facebook.com/DCCUChile"><meta property="og:locale" content="es_CL"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"\/"},{"@type":"ListItem","position":2,"name":"Laboratorioslaboratorio 4","item":"\/laboratorioslaboratorio-4\/"}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest></head><body class="laboratorios single"><div class="header-bar fixed-top"></div><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container><input class="menu-btn order-0" type=checkbox id=menu-btn>
<label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label><a class="navbar-brand order-1 order-md-0 mr-auto" href=/><img class=logo-light src=/images/banner.svg></img>
<img class=logo-dark src=/images/banner_dark.svg></img></a>
<button id=mode class="btn btn-link order-2 order-md-4" type=button aria-label="Toggle mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><ul class="navbar-nav social-nav order-3 order-md-5"><li class=nav-item><a class=nav-link href=https://github.com/cc5327/apunte><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><span class="ml-2 sr-only">GitHub</span></a></li></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav mr-auto order-5 order-md-2"><li class=nav-item><a class=nav-link href=/acerca>Info</a></li><li class=nav-item><a class=nav-link href=/auxiliares/enunciados/auxiliar-1>Auxiliares</a></li><li class=nav-item><a class=nav-link href=/laboratorios/>Laboratorios</a></li></ul><div class="break order-6 d-md-none"></div><form class="navbar-form flex-grow-1 order-7 order-md-3"><input id=userinput class="form-control is-search" type=search placeholder="Buscar Documentación..." aria-label="Buscar Documentación..." autocomplete=off><div id=suggestions class="shadow bg-white rounded"></div></form></div></div></header><div class="wrap container" role=document><div class=content><div class="row justify-content-center"><div class="col-md-12 col-lg-10 col-xl-8"><article><div class=blog-header><h1>Laboratorio 4: Seguridad de Redes</h1><p><small>Publicado el 03/07/2020&nbsp;&dash;&nbsp;<strong>Lectura de 5&nbsp;mins</strong></small><p></div><p class=lead></p><h2 id=instrucciones>Instrucciones</h2><p>La siguiente actividad está pensada para su desarrollo en un bloque de auxiliar y un poco más (~3 horas), en grupos de dos personas como máximo. Sin embargo, se les la posibilidad de entregarla hasta el <strong>próximo martes 21 de julio, a las 23:59 hrs, sin descuento por ello</strong> (El plazo es un poco mayor a 7 días debido al feriado e interferiado).</p><p>Al igual que en el laboratorio anterior, antes de partir, recuerden leer la sección de <a href=../>reglas de laboratorios</a>.</p><p>Para el desarrollo completo de este laboratorio, es necesario que se encuentre conectado a la VPN del CEC. Siga las instrucciones de la <a href=../../auxiliares/auxiliar-5>Auxiliar 5</a> para esto.</p><h3 id=pregunta-1-ataques-de-amplificación-3-puntos>Pregunta 1: Ataques de amplificación (3 puntos)</h3><p>En esta pregunta compararemos tres distintos servicios conocidos por ser propensos a ataques de amplificación, todos corriendo en el dominio <code>lab4.cc5312.xor.cl</code>:</p><ul><li><a href=https://github.com/memcached/memcached/blob/master/doc/protocol.txt>Memcached</a> (Puerto 11211), usando los comandos:<ul><li><code>stats</code></li><li><code>get</code> y <code>set</code> usados en conjunto.</li></ul></li><li><a href=https://www.ietf.org/rfc/rfc1035.txt>DNS</a> (Puerto 53) (<a href=https://scapy.readthedocs.io/en/latest/api/scapy.layers.dns.html#scapy.layers.dns.DNS>Documentación en Scapy</a>)
, a través de consultas de tipo:<ul><li><a href=https://blog.cloudflare.com/deprecating-dns-any-meta-query-type/>ANY</a> (qtype 255)</li><li><a href=https://tools.ietf.org/html/rfc5936>AXFR</a> (qtype 252)</li><li><a href=https://www.ietf.org/rfc/rfc1035.txt>TXT</a> (qtype 16)</li></ul></li><li><a href=http://www.ntp.org/>NTP</a> (Puerto 123) (<a href="https://scapy.readthedocs.io/en/latest/api/scapy.layers.ntp.html?highlight=ntpPrivate">Documentación en Scapy</a>
), a través de comando:<ul><li><a href=https://www.meinbergglobal.com/english/news/meinberg-security-advisory-mbgsa-1401-ntp-monlist-network-traffic-amplification-attacks.htm>monlist</a>.</li></ul></li></ul><p>(1 punto por servicio) Para cada servicio, realicen las siguientes tareas:</p><ul><li>(2 décimas) Expliquen, para cada comando del servicio, cuál es la utilidad original de éste y qué características de él lo vuelven adecuado para ejecutar ataques de amplificación, además de qué condiciones deben cumplirse en la configuración del servidor para poder ejecutar este ataque.</li><li>(2 décimas) Elaboren un script basado en <a href=https://github.com/cc5312/aux6>este código</a> que calcule el tamaño de paquete recibido y enviado en cada comando estudiado del protocolo. Para calcular los tamaños de las respuestas y preguntas, pueden usar la función de Python <code>len()</code>.</li><li>(3 décimas) Determinen y justifiquen un método para maximizar la eficiencia en la amplificación de un mensaje que dependa solamente del atacante. Definiremos la <strong>eficiencia de amplificación</strong> \(EF(M)\) como \(EF(M) = \frac{len(AMP(M))}{len(M)}\), donde \(M\) es el mensaje de entrada, \(AMP(M)\) es el mensaje de salida y \(len\) es una función de longitud en bytes.</li><li>(3 décimas) Modifiquen el script inicial para que utilice el método programado por ustedes (por ejemplo, enviando uno o más paquetes configurados de tal forma que una respuesta sea bastante grande) y muestre la eficiencia de amplificación obtenida (El resultado entregado en la práctica por su script puede ser menor a la eficiencia calculada, pero deben explicar qué condiciones deberían darse para maximizar esta eficiencia).</li></ul><p>Para cada servicio y comando, les recomendamos revisar la documentación enlazada en cada nombre para entender los cómo funcionan y contestan. También tienen a su disposición la documentación de la libería de <a href=https://scapy.readthedocs.io/en/latest/>Scapy</a>.</p><p><strong>Consejo para Memcached</strong>: Entiendan bien para qué sirve y cómo se utiliza el servicio Memcached. Revisen solamente el modo de uso de los comandos <code>stats</code> y el uso conjunto de los comandos <code>get</code> y <code>set</code>, definidos <a href=https://github.com/memcached/memcached/blob/master/doc/protocol.txt>acá</a> (no hay que leer el documento entero, solo hay que entender las definiciones de los comandos mencionados).</p><p><strong>Consejo para DNS</strong>: Enfóquense en las consultas de los tipos expuestos en la lista de arriba solamente. Consideren tanto los límites máximos de paquetes UDP según el <a href=https://www.ietf.org/rfc/rfc1035.txt>RFC1035</a> (Sección 4.2.1), así como también las formas de maximizar la cantidad de RRs o el largo de respuestas en el protocolo.</p><p><strong>Consejo para NTP</strong>: Consideren solamente el comando <code>MONLIST</code>, tal cual se usa en el código de ejemplo, e investiguen a partir de esta <a href=https://www.meinbergglobal.com/english/news/meinberg-security-advisory-mbgsa-1401-ntp-monlist-network-traffic-amplification-attacks.htm>documentación</a> cómo podrían maximizar el tamaño de la respuesta.</p><h3 id=pregunta-2-dns-spoofing-3-puntos>Pregunta 2: DNS Spoofing (3 puntos)</h3><p>En esta pregunta atacaremos a un cliente en la IP <code>172.17.69.106</code> que resuelve RRs de tipo A sobre el dominio <code>spoofed.lab4.cc5312.xor.cl</code> contra un resolver DNS dentro de la red del DCC cada 2 segundos. Sin embargo, las consultas DNS son realizadas siempre con el puerto de origen UDP <code>55312</code>, un ID de request DNS entre <code>1</code> y <code>1024</code>, <strong>y sin revisar que la IP de origen sea la correcta</strong>. Luego, el cliente se conecta vía <code>HTTP</code> a la url <code>http://&lt;ip-resuelta>:5312?flag=&lt;f></code>, donde <code>f</code> es un código <a href=https://en.wikipedia.org/wiki/Time-based_One-time_Password_algorithm>TOTP</a>.</p><p>Su objetivo es robar el código TOTP para un momento determinado. Para demostrar su obtención, necesita adjuntar tanto el código TOTP como el momento exacto de su obtención.</p><ul><li><p>(1 punto) Expliquen la factibilidad de un ataque de tipo DNS Spoofing si cada uno de estos problemas de implementación no existiera (manteniendo los otros problemas de implementación):</p><ul><li>(0.3 puntos): Si el puerto de origen de la consulta DNS variase constantemente.</li><li>(0.3 puntos): Si el ID de request pudiese tomar cualquier valor.</li><li>(0.4 puntos): Si el cliente no esperara paquetes de cualquier IP de origen.</li></ul></li><li><p>(1 punto) Teniendo en cuenta el impacto de cada problema de implementación mencionado anteriormente, creen un script basado en <a href=https://scapy.readthedocs.io/en/latest/>Scapy</a> que permita realizar un ataque de DNS Spoofing sobre las respuestas del cliente al dominio consultado, cambiando la IP del dominio <code>spoofed.lab4.cc5312.xor.cl</code> por la IP de ustedes en la VPN del CEC.</p></li></ul><p><strong>Consejo</strong>: Usen el código de ejemplo (La función de paquetes DNS) enlazado al inicio de este enunciado y modifíquenlo para realizar este ataque. Pueden aprovechar de realizar <strong>una sola consulta DNS</strong> ) (la pueden reutilizar durante todo el ataque) a un resolver accesible a ustedes (pueden usar <code>1.1.1.1</code> (Google), <code>8.8.8.8</code> (Cloudflare), <code>172.17.66.9</code> (Resolver dentro de la VPN) y luego modificar los campos correspondientes en la respuesta (IP destino, ID de consulta DNS, IP asociada al dominio consultado) para hacer el ataque.</p><ul><li>(1 punto) Recuperen los parámetros de la consulta `de la víctima levantando un servidor HTTP en el puerto 5312. Adjunten el código usado para levantar el servidor (pueden basarse en el código visto en la auxiliar 5). Repitan el ataque del punto anterior hasta recibir una consulta al servidor levantado y anoten tanto el código TOTP como la fecha y hora exactas en la que lo obtuvieron.</li></ul><p><strong>Consejo 3</strong>: El código TOTP está compuesto de 6 dígitos y cambia cada 30 segundos, por lo que deben registrar la hora de su obtención lo más cerca posible al momento en el que reciben el mensaje de la víctima. Les recomendamos automatizarlo en su script de Python.</p></article></div></div></div></div><footer class="footer text-muted"><div class=container><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Sitio generado con <a href=https://gohugo.io/>Hugo</a> y <a href=https://getdoks.org/>Doks</a></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-right"><ul class=list-inline><a href="http://creativecommons.org/licenses/by-sa/4.0/?ref=chooser-v1" target=_blank rel="license noopener noreferrer" style=display:inline-block>CC BY-SA 4.0<img style=height:22px!important;margin-left:3px;vertical-align:text-bottom src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img style=height:22px!important;margin-left:3px;vertical-align:text-bottom src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><img style=height:22px!important;margin-left:3px;vertical-align:text-bottom src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1"></a></ul></div></div></div></footer><script src=/main.2507c05f91ee016250e43b67b3d342f5a0d9d4dc5264f76cdc4518cd36a9e04cf3022ce8362802e618d8130b6733b53ee845a49e67229eeb3d3e70347db96a2b.js integrity="sha512-JQfAX5HuAWJQ5Dtns9NC9aDZ1NxSZPds3EUYzTap4EzzAizoNigC5hjYEwtnM7U+6EWknmcinus9PnA0fblqKw==" crossorigin=anonymous defer></script><script src=/index.min.95c2fb57984ca6cb1914e6658c1095cc47073a398c805d5ee842114fab739d64b4d5cd0626cda1be56c95e7f8c6e9c4d231866d1065245c873d731a6a7b01c5e.js integrity="sha512-lcL7V5hMpssZFOZljBCVzEcHOjmMgF1e6EIRT6tznWS01c0GJs2hvlbJXn+MbpxNIxhm0QZSRchz1zGmp7AcXg==" crossorigin=anonymous defer></script><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$'],['\\[','\\]']],processEscapes:true,processEnvironments:true},options:{skipHtmlTags:['script','noscript','style','textarea','pre']}};window.addEventListener('load',(event)=>{document.querySelectorAll("mjx-container").forEach(function(x){x.parentElement.classList+='has-jax'})});</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></body></html>