<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=stylesheet href=/main.6201f5d795e66fbf05304d1348e60656f52a2bf20b7376034a0071179ec8a5881eb69432e4b8ae7f7c05a22afa7f9e33f628dca5b1d53f1dadacd7b3e6a86691.css integrity="sha512-YgH115Xmb78FME0TSOYGVvUqK/ILc3YDSgBxF57IpYgetpQy5Liuf3wFoir6f54z9ijcpbHVPx2trNez5qhmkQ==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Auxiliar 2 - Introducción a la Seguridad Computacional</title><meta name=description content="DCC universidad de Chile"><link rel=canonical href=/auxiliares/enunciados/auxiliar-2/><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/logo_redondo.png"><meta name=twitter:title content="Auxiliar 2"><meta name=twitter:description content="En esta auxiliar veremos más en profundidad las diferencias entre cifradores de bloque y cifradores de flujo, además de entender un poco mejor el funcionamiento de algunos cifradores de flujo conocidos.
Resumen Cifradores A continuación se muestra una tabla comparativa entre cifradores de flujo y de bloque.
   Característica Cifrador de Bloque Cifrador de Flujo     ¿Es capaz de cifrar mensajes de largo arbitrario? Sí, al combinarse con un modo de operación Sí, por sí solo   ¿Resiste Ataque Two Time Pad?"><meta name=twitter:site content="@dccuchile"><meta name=twitter:creator content="@dccuchile"><meta property="og:title" content="Auxiliar 2"><meta property="og:description" content="En esta auxiliar veremos más en profundidad las diferencias entre cifradores de bloque y cifradores de flujo, además de entender un poco mejor el funcionamiento de algunos cifradores de flujo conocidos.
Resumen Cifradores A continuación se muestra una tabla comparativa entre cifradores de flujo y de bloque.
   Característica Cifrador de Bloque Cifrador de Flujo     ¿Es capaz de cifrar mensajes de largo arbitrario? Sí, al combinarse con un modo de operación Sí, por sí solo   ¿Resiste Ataque Two Time Pad?"><meta property="og:type" content="article"><meta property="og:url" content="/auxiliares/enunciados/auxiliar-2/"><meta property="og:image" content="/logo_redondo.png"><meta property="article:published_time" content="2020-03-26T20:12:32-03:00"><meta property="article:modified_time" content="2022-02-07T23:44:42-03:00"><meta property="og:site_name" content="Introducción a la Seguridad Computacional"><meta property="article:publisher" content="https://www.facebook.com/DCCUChile"><meta property="article:author" content="https://www.facebook.com/DCCUChile"><meta property="og:locale" content="es_CL"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"\/"},{"@type":"ListItem","position":2,"name":"Auxiliaresenunciadosauxiliar 2","item":"\/auxiliaresenunciadosauxiliar-2\/"}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest></head><body class="auxiliares single"><div class="header-bar fixed-top"></div><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container><input class="menu-btn order-0" type=checkbox id=menu-btn>
<label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label><a class="navbar-brand order-1 order-md-0 mr-auto" href=/><img class=logo-light src=/images/banner.svg></img>
<img class=logo-dark src=/images/banner_dark.svg></img></a>
<button id=mode class="btn btn-link order-2 order-md-4" type=button aria-label="Toggle mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><ul class="navbar-nav social-nav order-3 order-md-5"><li class=nav-item><a class=nav-link href=https://github.com/cc5327/apunte><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><span class="ml-2 sr-only">GitHub</span></a></li></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav mr-auto order-5 order-md-2"><li class=nav-item><a class=nav-link href=/acerca>Info</a></li><li class=nav-item><a class=nav-link href=/auxiliares/enunciados/auxiliar-1>Auxiliares</a></li><li class=nav-item><a class=nav-link href=/laboratorios/>Laboratorios</a></li></ul><div class="break order-6 d-md-none"></div><form class="navbar-form flex-grow-1 order-7 order-md-3"><input id=userinput class="form-control is-search" type=search placeholder="Buscar Documentación..." aria-label="Buscar Documentación..." autocomplete=off><div id=suggestions class="shadow bg-white rounded"></div></form></div></div></header><div class="wrap container" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar"><nav class=docs-links aria-label="Main navigation"><h3>anexos</h3><ul class=list-unstyled><li><a class=docs-link href=/auxiliares/anexos/padding-oracle/>Padding Oracle Attack a CBC</a></li><li><a class=docs-link href=/auxiliares/anexos/python-bytes/>Strings y Bytes en Python 3</a></li><li><a class=docs-link href=/auxiliares/anexos/gdb/>Uso básico de GDB</a></li></ul><h3>enunciados</h3><ul class=list-unstyled><li><a class=docs-link href=/auxiliares/enunciados/auxiliar-1/>Auxiliar 1</a></li><li><a class="docs-link active" href=/auxiliares/enunciados/auxiliar-2/>Auxiliar 2</a></li><li><a class=docs-link href=/auxiliares/enunciados/auxiliar-3/>Auxiliar 3</a></li><li><a class=docs-link href=/auxiliares/enunciados/auxiliar-4/>Auxiliar 4</a></li><li><a class=docs-link href=/auxiliares/enunciados/auxiliar-5/>Auxiliar 5</a></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>Contenidos</h3><nav id=TableOfContents><ul><li><a href=#resumen-cifradores>Resumen Cifradores</a></li><li><a href=#cifradores-de-flujo-conocidos>Cifradores de Flujo conocidos</a><ul><li><a href=#arc4>ARC4</a></li><li><a href=#salsa20-y-chacha20>Salsa20 y ChaCha20</a></li><li><a href=#ejercicios>Ejercicios</a></li></ul></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9 mx-xl-auto"><h1>Auxiliar 2</h1><p class=lead></p><p>En esta <em>auxiliar</em> veremos más en profundidad las diferencias entre cifradores de bloque y cifradores de flujo, además de entender un poco mejor el funcionamiento de algunos cifradores de flujo conocidos.</p><h2 id=resumen-cifradores>Resumen Cifradores<a href=#resumen-cifradores class=anchor aria-hidden=true>#</a></h2><p>A continuación se muestra una tabla comparativa entre cifradores de flujo y de bloque.</p><table><thead><tr><th>Característica</th><th>Cifrador de Bloque</th><th>Cifrador de Flujo</th></tr></thead><tbody><tr><td>¿Es capaz de cifrar mensajes de largo arbitrario?</td><td>Sí, al combinarse con un modo de operación</td><td>Sí, por sí solo</td></tr><tr><td>¿Resiste Ataque <em>Two Time Pad</em>?</td><td>Sí (gracias a difusión de resultado)</td><td>No (debido a que los bytes encriptados mantienen su posición)</td></tr><tr><td>¿Requiere Padding?</td><td>Sí, ya que cifra bloques de tamaño determinado</td><td>No, ya que cifra de a unidades pequeñas (Bit a bit, byte a byte)</td></tr><tr><td>¿Ofrece <em>Confidencialidad Perfecta</em>?</td><td>No</td><td>No</td></tr><tr><td>Ejemplos</td><td>DES, 3DES ,AES</td><td>ARC4, Salsa20, ChaCha20</td></tr></tbody></table><h2 id=cifradores-de-flujo-conocidos>Cifradores de Flujo conocidos<a href=#cifradores-de-flujo-conocidos class=anchor aria-hidden=true>#</a></h2><p>Ahora discutiremos algunas implementaciones de cifradores de flujo conocidos.</p><div class="alert alert-warning d-flex" role=alert><div class="flex-shrink-1 alert-icon">👉</div><div class=w-100>Ojo, si bien acá hay unas implementaciones de ejemplo, hay que recordar que en la vida real muy probablemente no debes tú mismo implementar estas operaciones. Busca alguna librería existente que haga este trabajo por ti.</div></div><h3 id=arc4>ARC4<a href=#arc4 class=anchor aria-hidden=true>#</a></h3><p>ARC4 toma su nombre del cifrador de flujo patentado RC4, desarrollado por RSA el año 1987. En el año 1994, una lista de correo <em>Cypherpunk</em> (Activistas pro-privacidad) filtra su implementación, a partir de lo cual sus implementaciones de código abierto se empiezan a llamar <em>ARC4</em> (Alleged RC4) para evitar problemas de marca.</p><p>ARC4 también es bastante conocido por estar relacionado a <em>WEP</em> (Wired Equivalent Privacy), <em>WPA</em> (Wireless Privacy Algorithm), <em>SSL</em> (Secure Sockets Layer) y <em>TLS</em> (Transport Layer Security).</p><p>En los últimos años se le han encontrado falencias y vulnerabilidades a ARC4 (fundamentalmente al usar llaves débiles), por lo que su uso ya no es recomendado.</p><h4 id=cómo-funciona>¿Cómo funciona?<a href=#cómo-funciona class=anchor aria-hidden=true>#</a></h4><p>ARC4 considera dos algoritmos:</p><ul><li><strong>Preparación de Llave</strong> <em>(Key Scheduling Algorithm)</em>: Se usa para preparar un arreglo S con la permutación de todos los posibles valores de un byte, a partir de una llave dada. Por lo general, la llave utilizada se suele combinar con un IV para evitar repetición de valores.</li></ul><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=c1># key es la llave, de largo entre 1 y 256</span>
<span class=k>def</span> <span class=nf>KSA</span><span class=p>():</span>
    <span class=n>S</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>*</span> <span class=mi>256</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>256</span><span class=p>)</span>
        <span class=n>S</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>i</span>
    <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>255</span><span class=p>):</span>
        <span class=n>j</span> <span class=o>=</span> <span class=p>(</span><span class=n>j</span> <span class=o>+</span> <span class=n>S</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>+</span> <span class=n>key</span><span class=p>[</span><span class=n>i</span> <span class=o>%</span> <span class=nb>len</span><span class=p>(</span><span class=n>key</span><span class=p>)])</span> <span class=o>%</span> <span class=mi>256</span>
        <span class=n>S</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>S</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>S</span><span class=p>[</span><span class=n>j</span><span class=p>],</span> <span class=n>S</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
    <span class=k>return</span> <span class=n>S</span>
</code></pre></div><ul><li><strong>Algoritmo de Generación Pseudoaleatoria</strong> <em>(Pseudo Random Generation Algorithm)</em>: Cada vez que se necesite, este algoritmo permite generar el próximo byte a usarse para encriptar un texto. La encriptación (como en todos los cifradores de flujo vistos) se realiza aplicando XOR entre el valor devuelto y el byte a encriptar.</li></ul><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=c1># Asumir que son globales</span>
<span class=n>i</span> <span class=o>=</span> <span class=mi>0</span> 
<span class=n>j</span> <span class=o>=</span> <span class=mi>0</span> 
<span class=k>def</span> <span class=nf>Encrypt</span><span class=p>(</span><span class=n>plain</span><span class=p>):</span>
    <span class=n>encrypted</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>plain</span><span class=p>)):</span>
        <span class=n>i</span> <span class=o>=</span> <span class=p>(</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>%</span> <span class=mi>256</span>
        <span class=n>j</span> <span class=o>=</span> <span class=p>(</span><span class=n>j</span> <span class=o>+</span> <span class=n>S</span><span class=p>[</span><span class=n>i</span><span class=p>])</span> <span class=o>%</span> <span class=mi>256</span>
        <span class=n>S</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>S</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>S</span><span class=p>[</span><span class=n>j</span><span class=p>],</span> <span class=n>S</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
        <span class=n>K</span> <span class=o>=</span> <span class=n>S</span><span class=p>[</span><span class=n>S</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>+</span> <span class=n>S</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>%</span> <span class=mi>256</span><span class=p>]</span>
        <span class=n>encrypted</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>plain</span><span class=p>[</span><span class=n>x</span><span class=p>]</span> <span class=o>^</span> <span class=n>K</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>encrypted</span>
</code></pre></div><p><img src=https://en.wikipedia.org/wiki/File:RC4.svg alt="Muestra de fase de generación">
Muestra de fase de generación.</p><p><strong>Trivia</strong>: Algunos sistemas operativos (Como Linux y OpenBSD) incluyen un generador de números aleatorio llamado <code>arc4random</code>. Como su nombre indica, inicialmente estaba basado en ARC4. Sin embargo, en los últimos años su implementación fue cambiada a ChaCha20 en varios sistemas operativos. Hoy en día, si llamas al <code>man</code> del algoritmo, sus mantenedores aclaran que el significado del comando es _A Replacement Call For Random`.</p><h3 id=salsa20-y-chacha20>Salsa20 y ChaCha20<a href=#salsa20-y-chacha20 class=anchor aria-hidden=true>#</a></h3><p>Salsa20 es un algoritmo de cifrado de flujo creado el 2005, mientras que ChaCha20 está basado en el algoritmo anterior y fue creado el 2008. Está basado en una función pseudoaleatoria que ejecuta operaciones de rotación, suma aritmética y XOR. Su estado inicial está compuesto de una llave de 256 bits, un nonce de 64 bits, posición de 64 bits y 128 bits fijos equivalentes a la palabra en ASCII &ldquo;expand 32-byte k&rdquo;. Estos valores están dispuestos en una matriz de 4 x 4 de la siguiente forma (en los paréntesis va el &ldquo;número de bloque&rdquo;):</p><table><thead><tr><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td>&ldquo;expa&rdquo; (0)</td><td>Llave (1)</td><td>Llave (2)</td><td>Llave (3)</td></tr><tr><td>Llave (4)</td><td>&ldquo;nd 3&rdquo; (5)</td><td>Nonce (6)</td><td>Nonce (7)</td></tr><tr><td>Pos (8)</td><td>Pos (9)</td><td>&ldquo;2-by&rdquo; (10)</td><td>Llave (11)</td></tr><tr><td>Llave (12)</td><td>Llave (13)</td><td>Llave (14)</td><td>&ldquo;te k&rdquo; (15)</td></tr></tbody></table><p>Asumiendo la existencia de esta función auxiliar:</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=k>def</span> <span class=nf>rot32</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
    <span class=k>return</span> <span class=n>a</span> <span class=o>&lt;&lt;</span> <span class=n>b</span> <span class=o>|</span> <span class=n>a</span> <span class=o>&gt;&gt;</span> <span class=p>(</span><span class=mi>32</span> <span class=o>-</span> <span class=n>b</span><span class=p>)</span>
</code></pre></div><p>Se define una operación principal que se ejecuta a lo largo del proceso de generación de aleatoriedad. A continuación la versión en python de esta operación:</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=k>def</span> <span class=nf>QR</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span><span class=p>,</span> <span class=n>d</span><span class=p>):</span>
    <span class=n>b</span> <span class=o>=</span> <span class=n>b</span> <span class=o>^</span> <span class=n>rot32</span><span class=p>((</span><span class=n>a</span> <span class=o>+</span> <span class=n>d</span><span class=p>),</span> <span class=mi>7</span><span class=p>)</span>
    <span class=n>c</span> <span class=o>=</span> <span class=n>c</span> <span class=o>^</span> <span class=n>rot32</span><span class=p>((</span><span class=n>b</span> <span class=o>+</span> <span class=n>a</span><span class=p>),</span> <span class=mi>9</span><span class=p>)</span>
    <span class=n>d</span> <span class=o>=</span> <span class=n>d</span> <span class=o>^</span> <span class=n>rot32</span><span class=p>((</span><span class=n>c</span> <span class=o>+</span> <span class=n>b</span><span class=p>),</span> <span class=mi>13</span><span class=p>)</span>
    <span class=n>a</span> <span class=o>=</span> <span class=n>a</span> <span class=o>^</span> <span class=n>rot32</span><span class=p>((</span><span class=n>d</span> <span class=o>+</span> <span class=n>c</span><span class=p>),</span> <span class=mi>18</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span><span class=p>,</span> <span class=n>d</span>
</code></pre></div><p>Aplicamos esta operación en cada fila en las rondas pares y en cada columna en las impares.</p><p>En Salsa20, se suelen usar 20 rondas.</p><p>El algoritmo para procesar un bloque es:</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=k>def</span> <span class=nf>process_block</span><span class=p>(</span><span class=n>input_block</span><span class=p>):</span> 
    <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=n>x</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>*</span><span class=mi>16</span>
    <span class=n>out</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>*</span><span class=mi>16</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>16</span><span class=p>):</span>
        <span class=n>x</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>input_block</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>ROUNDS</span><span class=o>/</span><span class=mi>2</span><span class=p>):</span>
        <span class=c1># Columnas</span>
        <span class=n>x</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>8</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>12</span><span class=p>]</span> <span class=o>=</span> <span class=n>QR</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>8</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>12</span><span class=p>])</span>
        <span class=n>x</span><span class=p>[</span><span class=mi>5</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>9</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>13</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>QR</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>5</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>9</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>13</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
        <span class=n>x</span><span class=p>[</span><span class=mi>10</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>14</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>6</span><span class=p>]</span> <span class=o>=</span> <span class=n>QR</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>10</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>14</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>6</span><span class=p>])</span>
        <span class=n>x</span><span class=p>[</span><span class=mi>15</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>7</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>11</span><span class=p>]</span> <span class=o>=</span> <span class=n>QR</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>15</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>7</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>11</span><span class=p>])</span>

        <span class=c1># Filas</span>
        <span class=n>QR</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>3</span><span class=p>])</span>
        <span class=n>QR</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>5</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>6</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>7</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>4</span><span class=p>])</span>
        <span class=n>QR</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>10</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>11</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>8</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>9</span><span class=p>])</span>
        <span class=n>QR</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>13</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>14</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>15</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>12</span><span class=p>])</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>16</span><span class=p>):</span>
        <span class=n>out</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>+</span> <span class=n>input_block</span><span class=p>[</span><span class=n>i</span><span class=p>])</span> <span class=o>%</span> <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=mi>32</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>out</span>
</code></pre></div><p>En el caso de ChaCha20, el algoritmo es muy similar, pero cambian tres partes:</p><ul><li>Disposición de estado inicial:</li></ul><table><thead><tr><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td>&ldquo;expa&rdquo; (0)</td><td>&ldquo;nd 3&rdquo; (1)</td><td>&ldquo;2-by&rdquo; (2)</td><td>&ldquo;te k&rdquo; (3)</td></tr><tr><td>Llave (4)</td><td>Llave (5)</td><td>Llave (6)</td><td>Llave (7)</td></tr><tr><td>Llave (8)</td><td>Llave (9)</td><td>Llave (10)</td><td>Llave (11)</td></tr><tr><td>Nonce (12)</td><td>Nonce (13)</td><td>Nonce (14)</td><td>Nonce (15)</td></tr></tbody></table><ul><li>En vez de filas se usan diagonales</li></ul><div class=highlight><pre class=chroma><code class=language-python data-lang=python>    <span class=o>...</span>
        <span class=c1># Columnas</span>
        <span class=n>QR</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>8</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>12</span><span class=p>])</span>
        <span class=n>QR</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>5</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>9</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>13</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
        <span class=n>QR</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>10</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>14</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>6</span><span class=p>])</span>
        <span class=n>QR</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>15</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>7</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>11</span><span class=p>])</span>

        <span class=c1># Diagonales</span>
        <span class=n>QR</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>5</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>10</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>15</span><span class=p>])</span>
        <span class=n>QR</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>6</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>11</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>12</span><span class=p>])</span>
        <span class=n>QR</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>7</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>8</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>13</span><span class=p>])</span>
        <span class=n>QR</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>9</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>14</span><span class=p>])</span>
    <span class=o>...</span>
</code></pre></div><ul><li>Función QR es distinta</li></ul><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=k>def</span> <span class=nf>QR</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span><span class=p>,</span> <span class=n>d</span><span class=p>):</span>
    <span class=n>a</span> <span class=o>+=</span> <span class=n>b</span>
    <span class=n>d</span> <span class=o>^=</span> <span class=n>a</span>
    <span class=n>d</span> <span class=o>=</span> <span class=n>rot32</span><span class=p>(</span><span class=n>d</span><span class=p>,</span> <span class=mi>16</span><span class=p>)</span>
    
    <span class=n>c</span> <span class=o>+=</span> <span class=n>d</span>
    <span class=n>b</span> <span class=o>^=</span> <span class=n>c</span>
    <span class=n>b</span> <span class=o>=</span> <span class=n>rot32</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=mi>12</span><span class=p>)</span>

    <span class=n>a</span> <span class=o>+=</span> <span class=n>b</span>
    <span class=n>d</span> <span class=o>^=</span> <span class=n>a</span>
    <span class=n>d</span> <span class=o>=</span> <span class=n>rot32</span><span class=p>(</span><span class=n>d</span><span class=p>,</span> <span class=mi>8</span><span class=p>)</span>
    
    <span class=n>c</span> <span class=o>+=</span> <span class=n>d</span>
    <span class=n>b</span> <span class=o>^=</span> <span class=n>c</span>
    <span class=n>b</span> <span class=o>=</span> <span class=n>rot32</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=mi>7</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span><span class=p>,</span> <span class=n>d</span>
</code></pre></div><p>Los entendidos dicen que la nueva QR sobre las diagonales ayudan a la difusión del input, es decir, que cambiando un bit del mensaje, su versión encriptada varía en una mayor cantidad de bits. Además, las operaciones definidas en las <em>quarter-rounds</em> (QRs) son más amigables con algunas arquitecturas de procesadores.</p><h3 id=ejercicios>Ejercicios<a href=#ejercicios class=anchor aria-hidden=true>#</a></h3><ul><li>Intenta hacer una implementación &ldquo;de juguete&rdquo; de ambos algoritmos. Por simplicidad, asume que el input en el caso de ChaCha/Salsa será siempre de tamaño múltiplo de 16 bytes.</li></ul><p class=edit-page><a href=https://github.com/cc5327/apunte/blob/main/content/auxiliares/enunciados/auxiliar-2.md><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>Editar en GitHub</a>
<span class=date-info><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>Modificado por última vez el 07/02/2022 a las 23:44:42 hrs.</span></p><div class="docs-navigation d-flex justify-content-between"><a href=/auxiliares/enunciados/auxiliar-1/><div class="card my-1"><div class="card-body py-2">&larr; Auxiliar 1</div></div></a><a class=ml-auto href=/auxiliares/enunciados/auxiliar-3/><div class="card my-1"><div class="card-body py-2">Auxiliar 3 &rarr;</div></div></a></div></main></div></div></div><footer class="footer text-muted"><div class=container><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Sitio generado con <a href=https://gohugo.io/>Hugo</a> y <a href=https://getdoks.org/>Doks</a></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-right"><ul class=list-inline><a href="http://creativecommons.org/licenses/by-sa/4.0/?ref=chooser-v1" target=_blank rel="license noopener noreferrer" style=display:inline-block>CC BY-SA 4.0<img style=height:22px!important;margin-left:3px;vertical-align:text-bottom src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img style=height:22px!important;margin-left:3px;vertical-align:text-bottom src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><img style=height:22px!important;margin-left:3px;vertical-align:text-bottom src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1"></a></ul></div></div></div></footer><script src=/main.2507c05f91ee016250e43b67b3d342f5a0d9d4dc5264f76cdc4518cd36a9e04cf3022ce8362802e618d8130b6733b53ee845a49e67229eeb3d3e70347db96a2b.js integrity="sha512-JQfAX5HuAWJQ5Dtns9NC9aDZ1NxSZPds3EUYzTap4EzzAizoNigC5hjYEwtnM7U+6EWknmcinus9PnA0fblqKw==" crossorigin=anonymous defer></script><script src=/index.min.95c2fb57984ca6cb1914e6658c1095cc47073a398c805d5ee842114fab739d64b4d5cd0626cda1be56c95e7f8c6e9c4d231866d1065245c873d731a6a7b01c5e.js integrity="sha512-lcL7V5hMpssZFOZljBCVzEcHOjmMgF1e6EIRT6tznWS01c0GJs2hvlbJXn+MbpxNIxhm0QZSRchz1zGmp7AcXg==" crossorigin=anonymous defer></script><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$'],['\\[','\\]']],processEscapes:true,processEnvironments:true},options:{skipHtmlTags:['script','noscript','style','textarea','pre']}};window.addEventListener('load',(event)=>{document.querySelectorAll("mjx-container").forEach(function(x){x.parentElement.classList+='has-jax'})});</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></body></html>