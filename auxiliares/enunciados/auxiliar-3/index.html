<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=stylesheet href=/main.6201f5d795e66fbf05304d1348e60656f52a2bf20b7376034a0071179ec8a5881eb69432e4b8ae7f7c05a22afa7f9e33f628dca5b1d53f1dadacd7b3e6a86691.css integrity="sha512-YgH115Xmb78FME0TSOYGVvUqK/ILc3YDSgBxF57IpYgetpQy5Liuf3wFoir6f54z9ijcpbHVPx2trNez5qhmkQ==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Auxiliar 3 - Introducción a la Seguridad Computacional</title><meta name=description content="DCC universidad de Chile"><link rel=canonical href=/auxiliares/enunciados/auxiliar-3/><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/logo_redondo.png"><meta name=twitter:title content="Auxiliar 3"><meta name=twitter:description content="En esta auxiliar veremos una ejemplo de ataque de Man-in-the-Middle, con el código que pueden bajar de este enlace. El código está en python y el README indica qué hacer para dejarlo corriendo.
¿Cómo funciona? El código asume lo siguiente:
 Existe un repositorio autoritativo que mapea nombres con direcciones IP (y puertos). Este repositorio está configurado como un archivo json en el sitio del curso: https://users.dcc.uchile.cl/~eriveros/cc5312/addressbook.json Existen tres modos de uso:  receive: Recibe un archivo, escuchando en un puerto send: Envía un archivo a un nombre, el cual es resuelto a IP:Puerto consultando al repositorio autoritativo mitm: Intercepta las comunicaciones entre un emisor y un receptor, leyendo el mensaje sin ser detectado (reenviando lo recibido por send a receive)."><meta name=twitter:site content="@dccuchile"><meta name=twitter:creator content="@dccuchile"><meta property="og:title" content="Auxiliar 3"><meta property="og:description" content="En esta auxiliar veremos una ejemplo de ataque de Man-in-the-Middle, con el código que pueden bajar de este enlace. El código está en python y el README indica qué hacer para dejarlo corriendo.
¿Cómo funciona? El código asume lo siguiente:
 Existe un repositorio autoritativo que mapea nombres con direcciones IP (y puertos). Este repositorio está configurado como un archivo json en el sitio del curso: https://users.dcc.uchile.cl/~eriveros/cc5312/addressbook.json Existen tres modos de uso:  receive: Recibe un archivo, escuchando en un puerto send: Envía un archivo a un nombre, el cual es resuelto a IP:Puerto consultando al repositorio autoritativo mitm: Intercepta las comunicaciones entre un emisor y un receptor, leyendo el mensaje sin ser detectado (reenviando lo recibido por send a receive)."><meta property="og:type" content="article"><meta property="og:url" content="/auxiliares/enunciados/auxiliar-3/"><meta property="og:image" content="/logo_redondo.png"><meta property="article:published_time" content="2020-04-14T20:12:32-03:00"><meta property="article:modified_time" content="2022-02-07T23:44:42-03:00"><meta property="og:site_name" content="Introducción a la Seguridad Computacional"><meta property="article:publisher" content="https://www.facebook.com/DCCUChile"><meta property="article:author" content="https://www.facebook.com/DCCUChile"><meta property="og:locale" content="es_CL"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"\/"},{"@type":"ListItem","position":2,"name":"Auxiliaresenunciadosauxiliar 3","item":"\/auxiliaresenunciadosauxiliar-3\/"}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest></head><body class="auxiliares single"><div class="header-bar fixed-top"></div><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container><input class="menu-btn order-0" type=checkbox id=menu-btn>
<label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label><a class="navbar-brand order-1 order-md-0 mr-auto" href=/><img class=logo-light src=/images/banner.svg></img>
<img class=logo-dark src=/images/banner_dark.svg></img></a>
<button id=mode class="btn btn-link order-2 order-md-4" type=button aria-label="Toggle mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><ul class="navbar-nav social-nav order-3 order-md-5"><li class=nav-item><a class=nav-link href=https://github.com/cc5327/apunte><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><span class="ml-2 sr-only">GitHub</span></a></li></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav mr-auto order-5 order-md-2"><li class=nav-item><a class=nav-link href=/acerca>Info</a></li><li class=nav-item><a class=nav-link href=/auxiliares/enunciados/auxiliar-1>Auxiliares</a></li><li class=nav-item><a class=nav-link href=/laboratorios/>Laboratorios</a></li></ul><div class="break order-6 d-md-none"></div><form class="navbar-form flex-grow-1 order-7 order-md-3"><input id=userinput class="form-control is-search" type=search placeholder="Buscar Documentación..." aria-label="Buscar Documentación..." autocomplete=off><div id=suggestions class="shadow bg-white rounded"></div></form></div></div></header><div class="wrap container" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar"><nav class=docs-links aria-label="Main navigation"><h3>anexos</h3><ul class=list-unstyled><li><a class=docs-link href=/auxiliares/anexos/padding-oracle/>Padding Oracle Attack a CBC</a></li><li><a class=docs-link href=/auxiliares/anexos/python-bytes/>Strings y Bytes en Python 3</a></li><li><a class=docs-link href=/auxiliares/anexos/gdb/>Uso básico de GDB</a></li></ul><h3>enunciados</h3><ul class=list-unstyled><li><a class=docs-link href=/auxiliares/enunciados/auxiliar-1/>Auxiliar 1</a></li><li><a class=docs-link href=/auxiliares/enunciados/auxiliar-2/>Auxiliar 2</a></li><li><a class="docs-link active" href=/auxiliares/enunciados/auxiliar-3/>Auxiliar 3</a></li><li><a class=docs-link href=/auxiliares/enunciados/auxiliar-4/>Auxiliar 4</a></li><li><a class=docs-link href=/auxiliares/enunciados/auxiliar-5/>Auxiliar 5</a></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>Contenidos</h3><nav id=TableOfContents><ul><li><ul><li><a href=#cómo-funciona>¿Cómo funciona?</a></li><li><a href=#cómo-se-ejecutaría-un-ataque>¿Cómo se ejecutaría un ataque?</a></li><li><a href=#el-ataque>El ataque</a></li><li><a href=#esto-ocurre-en-la-realidad>¿Esto ocurre en la realidad?</a></li><li><a href=#el-código-fuente>El código fuente</a></li></ul></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9 mx-xl-auto"><h1>Auxiliar 3</h1><p class=lead></p><p>En esta auxiliar veremos una ejemplo de ataque de <code>Man-in-the-Middle</code>, con el código que pueden bajar de <a href=https://github.com/cc5312/transfer>este enlace</a>. El código está en python y el README indica qué hacer para dejarlo corriendo.</p><h3 id=cómo-funciona>¿Cómo funciona?<a href=#cómo-funciona class=anchor aria-hidden=true>#</a></h3><p>El código asume lo siguiente:</p><ul><li>Existe un repositorio autoritativo que mapea nombres con direcciones IP (y puertos). Este repositorio está configurado como un archivo <code>json</code> en el sitio del curso: <code>https://users.dcc.uchile.cl/~eriveros/cc5312/addressbook.json</code></li><li>Existen tres modos de uso:<ul><li><code>receive</code>: Recibe un archivo, escuchando en un puerto</li><li><code>send</code>: Envía un archivo a un <code>nombre</code>, el cual es resuelto a IP:Puerto consultando al repositorio autoritativo</li><li><code>mitm</code>: Intercepta las comunicaciones entre un emisor y un receptor, leyendo el mensaje sin ser detectado (reenviando lo recibido por <code>send</code> a <code>receive</code>).</li></ul></li><li>En un uso normal, la persona receptora escucha un intento de conexión de alguna persona emisora.</li><li>Al haber conexión, la persona receptora envía su llave pública, de forma que la receptora pueda cifrar la llave simétrica que usará para cifrar un archivo más grande.</li></ul><h3 id=cómo-se-ejecutaría-un-ataque>¿Cómo se ejecutaría un ataque?<a href=#cómo-se-ejecutaría-un-ataque class=anchor aria-hidden=true>#</a></h3><p>En este caso, asumimos que emisora y receptora no se han comunicado antes, por lo que la emisora no tiene forma de comprobar que la llave recibida sea la de la receptora.</p><ul><li>Primero, se colocan las IPs y puertos a usar en un archivo <code>addressbook.json</code> que esté al alcance de todas las personas participantes.</li><li>Luego, la receptora espera un archivo en el mismo puerto declarado en el <code>addressbook</code>.</li><li>En algún momento, la atacante logra modificar el <code>addressbook</code> de tal forma que hace que el nombre de la receptora apunte a una IP controlada por ella (atacante).</li><li>La emisora envía un mensaje al nombre de la receptora, pero se rutea a la atacante.</li><li>La atacante reenvía los mensajes recibidos a la receptora para que no se note la interrupción de las comunicaciones. Al mismo tiempo, envía a la emisora su llave pública.</li><li>La atacante recibe de la receptora su llave pública y la guarda para uso posterior. Luego la atacante envía su llave pública a la emisora.</li><li>Si la emisora había visto previamente la llave pública de la receptora, puede compararlas. Si son distintas, puede abortar el protocolo. Si son iguales, puede continuar sabiendo que se está comunicando con la misma persona de la vez pasada. El mayor problema ocurre si es la primera vez que se comunica con la receptora, ya que no tiene forma de saber si es ella quién dice ser.</li><li>En este caso, la emisora acepta la llave pública y cifra una llave simétrica generada aleatoriamente con la llave pública recibida, enviándosela a quién cree es la receptora.</li><li>La atacante recibe la llave simétrica cifrada con su llave pública y la descifra. Luego la cifra con la llave pública de la receptora y se la envía.</li><li>La receptora recibe la llave simétrica cifrada con su llave pública y la descifra.</li><li>Mientras tanto, la emisora envía bloques cifrados del archivo a quién cree es la receptora.</li><li>La atacante recibe los bloques enviados a ella, los descifra con la llave simétria que maneja, los guarda como un archivo y luego reenvía lo mismo que recibió a la receptora verdadera.</li><li>La receptora verdadera recibe los bloques enviados a ella, los descifra con la llave simétrica que maneja y los guarda como un archivo.</li></ul><p>El siguiente diagrama muestra este mismo flujo:</p><p><img src=mitm.png alt="Diagrama del ataque"></p><h3 id=el-ataque>El ataque<a href=#el-ataque class=anchor aria-hidden=true>#</a></h3><h3 id=esto-ocurre-en-la-realidad>¿Esto ocurre en la realidad?<a href=#esto-ocurre-en-la-realidad class=anchor aria-hidden=true>#</a></h3><p>Sí, de hecho, el servicio <a href=https://en.wikipedia.org/wiki/Secure_Shell>SSH</a> utiliza un archivo llamado <code>known_hosts</code> en el cual se guarda un historial de las llaves públicas recibidas de cada sitio o IP a la cual te conectas. Cuando intentas conectarte a un servidor después de la primera vez, el programa revisa que la llave pública recibida sea la misma que recuerda. Si son distintas, la aplicación alerta a través de un mensaje y niega la realización de la conexión. La siguiente imagen muestra este caso:</p><p><img src=http://1.bp.blogspot.com/-ie539NGtgRU/UdRUx1od04I/AAAAAAAABX8/OCeIj7_ypdI/s724/offending_RSA_key.png alt="Error de cambio de llave pública"></p><p>Esto se parece un poco a la técnica de <em>Certificate Pinning</em> usada en aplicaciones móviles para evitar que las comunicaciones entre el cliente y el servidor sean interceptadas. Como la aplicación sabe qué certificado debiese esperar, al recibir uno distinto al esperado aborta la conexión.</p><h3 id=el-código-fuente>El código fuente<a href=#el-código-fuente class=anchor aria-hidden=true>#</a></h3><p>Los detalles para usar el código fuente se pueden encontrar en el archivo README.md del <a href=https://github.com/cc5312/transfer>repositorio</a>.</p><p class=edit-page><a href=https://github.com/cc5327/apunte/blob/main/content/auxiliares/enunciados/auxiliar-3.md><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>Editar en GitHub</a>
<span class=date-info><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>Modificado por última vez el 07/02/2022 a las 23:44:42 hrs.</span></p><div class="docs-navigation d-flex justify-content-between"><a href=/auxiliares/enunciados/auxiliar-2/><div class="card my-1"><div class="card-body py-2">&larr; Auxiliar 2</div></div></a><a class=ml-auto href=/auxiliares/enunciados/auxiliar-4/><div class="card my-1"><div class="card-body py-2">Auxiliar 4 &rarr;</div></div></a></div></main></div></div></div><footer class="footer text-muted"><div class=container><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Sitio generado con <a href=https://gohugo.io/>Hugo</a> y <a href=https://getdoks.org/>Doks</a></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-right"><ul class=list-inline><a href="http://creativecommons.org/licenses/by-sa/4.0/?ref=chooser-v1" target=_blank rel="license noopener noreferrer" style=display:inline-block>CC BY-SA 4.0<img style=height:22px!important;margin-left:3px;vertical-align:text-bottom src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img style=height:22px!important;margin-left:3px;vertical-align:text-bottom src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><img style=height:22px!important;margin-left:3px;vertical-align:text-bottom src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1"></a></ul></div></div></div></footer><script src=/main.2507c05f91ee016250e43b67b3d342f5a0d9d4dc5264f76cdc4518cd36a9e04cf3022ce8362802e618d8130b6733b53ee845a49e67229eeb3d3e70347db96a2b.js integrity="sha512-JQfAX5HuAWJQ5Dtns9NC9aDZ1NxSZPds3EUYzTap4EzzAizoNigC5hjYEwtnM7U+6EWknmcinus9PnA0fblqKw==" crossorigin=anonymous defer></script><script src=/index.min.95c2fb57984ca6cb1914e6658c1095cc47073a398c805d5ee842114fab739d64b4d5cd0626cda1be56c95e7f8c6e9c4d231866d1065245c873d731a6a7b01c5e.js integrity="sha512-lcL7V5hMpssZFOZljBCVzEcHOjmMgF1e6EIRT6tznWS01c0GJs2hvlbJXn+MbpxNIxhm0QZSRchz1zGmp7AcXg==" crossorigin=anonymous defer></script><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$'],['\\[','\\]']],processEscapes:true,processEnvironments:true},options:{skipHtmlTags:['script','noscript','style','textarea','pre']}};window.addEventListener('load',(event)=>{document.querySelectorAll("mjx-container").forEach(function(x){x.parentElement.classList+='has-jax'})});</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></body></html>